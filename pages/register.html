<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriPlanner - ƒêƒÉng k√Ω</title>
    <meta name="description" content="T·∫°o t√†i kho·∫£n AgriPlanner ƒë·ªÉ qu·∫£n l√Ω n√¥ng tr·∫°i th√¥ng minh">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">

    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/pages/auth.css">
    <link rel="stylesheet" href="../css/chatbot.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
</head>

<body data-page="register">
    <div class="auth-container">
        <!-- Left Panel - Hero -->
        <div class="auth-hero">
            <div class="auth-hero__bg">
                <img src="https://images.unsplash.com/photo-1625246333195-78d9c38ad449?w=1600" alt="C√°nh ƒë·ªìng l√∫a"
                    class="auth-hero__bg-image">
                <div class="auth-hero__overlay"></div>
            </div>

            <div class="auth-hero__logo">
                <div class="auth-hero__logo-icon" style="background: none; padding: 0;">
                    <img src="../images/logo.png" alt="AgriPlanner"
                        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
                <span class="auth-hero__logo-text">AgriPlanner</span>
            </div>

            <div class="auth-hero__content">
                <div class="auth-testimonials" id="register-testimonials">
                    <!-- Slide 1 -->
                    <div class="auth-testimonial-slide active">
                        <div class="auth-hero__stars">
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                        </div>
                        <blockquote class="auth-hero__quote">
                            "C√¥ng ngh·ªá hi·ªán ƒë·∫°i k·∫øt h·ª£p kinh nghi·ªám truy·ªÅn th·ªëng - AgriPlanner gi√∫p ch√∫ng t√¥i ƒë·∫°t ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥."
                        </blockquote>
                        <p class="auth-hero__author">Tr·∫ßn Th·ªã Hoa</p>
                        <p class="auth-hero__author-role">Gi√°m ƒë·ªëc HTX N√¥ng nghi·ªáp, T√¢y Nguy√™n</p>
                    </div>

                    <!-- Slide 2 -->
                    <div class="auth-testimonial-slide">
                        <div class="auth-hero__stars">
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                        </div>
                        <blockquote class="auth-hero__quote">
                            "Nh·ªù AgriPlanner, t√¥i c√≥ th·ªÉ qu·∫£n l√Ω 200 c√¥ng nh√¢n tr√™n 3 n√¥ng tr·∫°i m√† kh√¥ng c·∫ßn ph·∫£i di chuy·ªÉn li√™n t·ª•c. Th·∫≠t tuy·ªát v·ªùi!"
                        </blockquote>
                        <p class="auth-hero__author">Nguy·ªÖn Ho√†ng Nam</p>
                        <p class="auth-hero__author-role">Ch·ªß doanh nghi·ªáp n√¥ng nghi·ªáp, Long An</p>
                    </div>

                    <!-- Slide 3 -->
                    <div class="auth-testimonial-slide">
                        <div class="auth-hero__stars">
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                        </div>
                        <blockquote class="auth-hero__quote">
                            "T√≠nh nƒÉng truy xu·∫•t ngu·ªìn g·ªëc gi√∫p s·∫£n ph·∫©m c·ªßa ch√∫ng t√¥i x√¢y d·ª±ng ƒë∆∞·ª£c ni·ªÅm tin v·ªõi ng∆∞·ªùi ti√™u d√πng. Doanh thu tƒÉng 50%."
                        </blockquote>
                        <p class="auth-hero__author">ƒê·ªó Minh Tu·∫•n</p>
                        <p class="auth-hero__author-role">Ch·ªß trang tr·∫°i rau s·∫°ch, H√† N·ªôi</p>
                    </div>

                    <!-- Slide 4 -->
                    <div class="auth-testimonial-slide">
                        <div class="auth-hero__stars">
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                        </div>
                        <blockquote class="auth-hero__quote">
                            "Ph√¢n t√≠ch AI c·ªßa AgriPlanner ƒë√£ ph√°t hi·ªán s·ªõm d·ªãch b·ªánh tr√™n v∆∞·ªùn ti√™u c·ªßa t√¥i, gi√∫p c·ª©u ƒë∆∞·ª£c h∆°n 2 hecta c√¢y tr·ªìng qu√Ω gi√°."
                        </blockquote>
                        <p class="auth-hero__author">Hu·ª≥nh Th·ªã B√≠ch Ng·ªçc</p>
                        <p class="auth-hero__author-role">N√¥ng d√¢n ti√™u bi·ªÉu, B√† R·ªãa - V≈©ng T√†u</p>
                    </div>

                    <!-- Slide 5 -->
                    <div class="auth-testimonial-slide">
                        <div class="auth-hero__stars">
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                            <span class="material-symbols-outlined auth-hero__star">star</span>
                        </div>
                        <blockquote class="auth-hero__quote">
                            "C·ª≠a h√†ng tr·ª±c tuy·∫øn tr√™n AgriPlanner gi√∫p t√¥i b√°n tr·ª±c ti·∫øp ƒë·∫øn ng∆∞·ªùi ti√™u d√πng, b·ªè qua trung gian v√† tƒÉng l·ª£i nhu·∫≠n g·∫•p ƒë√¥i."
                        </blockquote>
                        <p class="auth-hero__author">L√Ω VƒÉn Phong</p>
                        <p class="auth-hero__author-role">Ch·ªß v∆∞·ªùn tr√°i c√¢y, Ti·ªÅn Giang</p>
                    </div>
                </div>

                <div class="auth-carousel-dots" id="register-carousel-dots">
                    <button class="auth-carousel-dot active" data-index="0"></button>
                    <button class="auth-carousel-dot" data-index="1"></button>
                    <button class="auth-carousel-dot" data-index="2"></button>
                    <button class="auth-carousel-dot" data-index="3"></button>
                    <button class="auth-carousel-dot" data-index="4"></button>
                </div>

                <div class="auth-hero__stats">
                    <div class="auth-stat">
                        <p class="auth-stat__value">500K+</p>
                        <p class="auth-stat__label">Hecta ƒë∆∞·ª£c qu·∫£n l√Ω</p>
                    </div>
                    <div class="auth-stat">
                        <p class="auth-stat__value">35%</p>
                        <p class="auth-stat__label">TƒÉng nƒÉng su·∫•t</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Register Form -->
        <div class="auth-form-panel">
            <!-- Mobile Logo -->
            <div class="auth-mobile-logo">
                <div class="auth-mobile-logo__icon" style="background: none; padding: 0;">
                    <img src="../images/logo.png" alt="AgriPlanner"
                        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
                <span class="auth-mobile-logo__text">AgriPlanner</span>
            </div>

            <form class="auth-form" id="register-form">
                <div class="auth-form__header">
                    <h1 class="auth-form__title">T·∫°o t√†i kho·∫£n</h1>
                    <p class="auth-form__subtitle">
                        ƒê√£ c√≥ t√†i kho·∫£n? <a href="login.html">ƒêƒÉng nh·∫≠p</a>
                    </p>
                </div>

                <div class="auth-form__fields">
                    <!-- Vai tr√≤ - FIRST -->
                    <div class="auth-form__field">
                        <label class="auth-form__label" for="role">Vai tr√≤ c·ªßa b·∫°n</label>
                        <div class="auth-form__input-wrapper">
                            <select id="role" class="auth-form__input auth-form__select" required>
                                <option value="" disabled selected>Ch·ªçn vai tr√≤...</option>
                                <option value="OWNER">Ch·ªß trang tr·∫°i - T·∫°o v√† qu·∫£n l√Ω n√¥ng tr·∫°i</option>
                                <option value="WORKER">Nh√¢n c√¥ng - L√†m vi·ªác t·∫°i n√¥ng tr·∫°i c√≥ s·∫µn</option>
                                <option value="SYSTEM_ADMIN">Qu·∫£n tr·ªã vi√™n h·ªá th·ªëng</option>
                            </select>
                            <span class="material-symbols-outlined auth-form__input-icon">badge</span>
                        </div>
                        <p class="auth-form__role-hint" id="role-hint"
                            style="font-size: 12px; color: var(--color-text-muted); margin-top: 4px;"></p>
                    </div>

                    <!-- Invitation Code - Only for SYSTEM_ADMIN -->
                    <div class="auth-form__field" id="invitation-code-field" style="display: none;">
                        <label class="auth-form__label" for="invitationCode">M√£ m·ªùi qu·∫£n tr·ªã vi√™n</label>
                        <div class="auth-form__input-wrapper">
                            <input type="text" id="invitationCode" class="auth-form__input" placeholder="Nh·∫≠p m√£ m·ªùi">
                            <span class="material-symbols-outlined auth-form__input-icon">key</span>
                        </div>
                    </div>

                    <!-- T√™n n√¥ng tr·∫°i - Dynamic based on role -->
                    <div class="auth-form__field" id="farm-field">
                        <label class="auth-form__label" for="farmName" id="farm-label">T√™n n√¥ng tr·∫°i</label>
                        <div class="auth-form__input-wrapper" id="farm-input-wrapper">
                            <!-- Default: text input for OWNER -->
                            <input type="text" id="farmName" class="auth-form__input"
                                placeholder="Nh·∫≠p t√™n n√¥ng tr·∫°i c·ªßa b·∫°n">
                            <span class="material-symbols-outlined auth-form__input-icon">agriculture</span>
                        </div>
                    </div>

                    <!-- H·ªç v√† t√™n -->
                    <div class="auth-form__field">
                        <label class="auth-form__label" for="fullName">H·ªç v√† t√™n</label>
                        <div class="auth-form__input-wrapper">
                            <input type="text" id="fullName" class="auth-form__input" placeholder="Nh·∫≠p h·ªç v√† t√™n"
                                required>
                            <span class="material-symbols-outlined auth-form__input-icon">person</span>
                        </div>
                    </div>

                    <!-- S·ªë ƒëi·ªán tho·∫°i -->
                    <div class="auth-form__field">
                        <label class="auth-form__label" for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
                        <div class="auth-form__input-wrapper">
                            <input type="tel" id="phone" class="auth-form__input" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                            <span class="material-symbols-outlined auth-form__input-icon">phone</span>
                        </div>
                    </div>

                    <div class="auth-form__field">
                        <label class="auth-form__label" for="email">Email</label>
                        <div class="auth-form__input-wrapper">
                            <input type="email" id="email" class="auth-form__input" placeholder="Nh·∫≠p email" required>
                            <span class="material-symbols-outlined auth-form__input-icon">mail</span>
                        </div>
                    </div>

                    <div class="auth-form__field">
                        <label class="auth-form__label" for="password">M·∫≠t kh·∫©u</label>
                        <div class="auth-form__input-wrapper">
                            <input type="password" id="password" class="auth-form__input"
                                placeholder="Nh·∫≠p m·∫≠t kh·∫©u (t·ªëi thi·ªÉu 8 k√Ω t·ª±)" required minlength="8">
                            <span class="material-symbols-outlined auth-form__input-icon" id="toggle-password"
                                style="cursor: pointer;">visibility_off</span>
                        </div>
                    </div>

                    <div class="auth-form__field">
                        <label class="auth-form__label" for="confirmPassword">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                        <div class="auth-form__input-wrapper">
                            <input type="password" id="confirmPassword" class="auth-form__input"
                                placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required minlength="8">
                            <span class="material-symbols-outlined auth-form__input-icon" id="toggle-confirm-password"
                                style="cursor: pointer;">visibility_off</span>
                        </div>
                    </div>

                    <div class="auth-form__terms">
                        <input type="checkbox" class="auth-form__terms-checkbox" id="terms" required>
                        <label for="terms" class="auth-form__terms-text">
                            T√¥i ƒë·ªìng √Ω v·ªõi <a href="#">ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</a> v√† <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a> c·ªßa
                            AgriPlanner
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn btn--primary auth-form__submit">
                    T·∫°o t√†i kho·∫£n
                </button>

                <div class="auth-form__divider">
                    <div class="auth-form__divider-line"></div>
                    <span class="auth-form__divider-text">ho·∫∑c ƒëƒÉng k√Ω v·ªõi</span>
                </div>

                <div class="auth-form__social-buttons">
                    <button type="button" class="auth-form__social auth-form__social--google" id="btn-google-register">
                        <svg class="auth-form__social-icon" viewBox="0 0 24 24">
                            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" />
                            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" />
                            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" />
                            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" />
                        </svg>
                        <span class="auth-form__social-text">Google</span>
                    </button>

                    <button type="button" class="auth-form__social auth-form__social--facebook" id="btn-facebook-register">
                        <svg class="auth-form__social-icon" viewBox="0 0 24 24">
                            <path fill="#1877F2" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        <span class="auth-form__social-text">Facebook</span>
                    </button>

                    <button type="button" class="auth-form__social auth-form__social--github" id="btn-github-register">
                        <svg class="auth-form__social-icon" viewBox="0 0 24 24">
                            <path fill="#333" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        <span class="auth-form__social-text">GitHub</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/auth.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/animations.js"></script>

    <script>
        // ============================================
        // CONSTANTS
        // ============================================
        const API_URL = 'http://localhost:8080/api/auth';
        const GOOGLE_CLIENT_ID = '546685859099-lkr6apepqtt1le90p7dqnsnouh9p2e0g.apps.googleusercontent.com';
        const FACEBOOK_APP_ID = '732046953176825';
        const GITHUB_CLIENT_ID = 'Ov23li1eRKn4dyaATfHh';

        // Store social data temporarily
        let pendingSocialData = null;

        // ============================================
        // TOGGLE PASSWORD
        // ============================================
        document.getElementById('toggle-password').addEventListener('click', function () {
            const passwordInput = document.getElementById('password');
            const icon = this;

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = 'visibility';
            } else {
                passwordInput.type = 'password';
                icon.textContent = 'visibility_off';
            }
        });

        // Toggle confirm password visibility
        document.getElementById('toggle-confirm-password').addEventListener('click', function () {
            const passwordInput = document.getElementById('confirmPassword');
            const icon = this;

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.textContent = 'visibility';
            } else {
                passwordInput.type = 'password';
                icon.textContent = 'visibility_off';
            }
        });

        // Success modal function
        function showSuccessModal(message, isWorker = false) {
            const modalHtml = `
                <div id="success-modal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    animation: fadeIn 0.3s ease;
                ">
                    <div style="
                        background: white;
                        padding: 40px;
                        border-radius: 16px;
                        text-align: center;
                        max-width: 450px;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        animation: slideUp 0.3s ease;
                    ">
                        <div style="
                            width: 80px;
                            height: 80px;
                            background: linear-gradient(135deg, ${isWorker ? '#3b82f6, #1d4ed8' : '#10b981, #059669'});
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto 24px;
                        ">
                            <span class="material-symbols-outlined" style="font-size: 48px; color: white;">${isWorker ? 'description' : 'check_circle'}</span>
                        </div>
                        <h2 style="color: #1f2937; margin-bottom: 12px; font-size: 24px;">${isWorker ? 'üìã H·ªì s∆° ƒë√£ g·ª≠i!' : 'üéâ Ch√∫c m·ª´ng!'}</h2>
                        <p style="color: #6b7280; margin-bottom: 24px; font-size: 16px; line-height: 1.6;">
                            ${message || (isWorker ?
                    'H·ªì s∆° ·ª©ng tuy·ªÉn c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!<br>Ch·ªß trang tr·∫°i s·∫Ω xem x√©t v√† ph√™ duy·ªát.<br>B·∫°n s·∫Ω nh·∫≠n th√¥ng b√°o khi ƒë∆∞·ª£c duy·ªát.' :
                    'ƒêƒÉng k√Ω t√†i kho·∫£n th√†nh c√¥ng!<br>B·∫°n s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn trang ƒëƒÉng nh·∫≠p.')}
                        </p>
                        ${isWorker ? `
                            <div style="background: #eff6ff; padding: 16px; border-radius: 8px; margin-bottom: 24px; text-align: left;">
                                <p style="color: #1e40af; font-size: 14px; margin: 0; display: flex; align-items: center; gap: 8px;">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">info</span>
                                    Sau khi ƒë∆∞·ª£c duy·ªát, b·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p v√† b·∫Øt ƒë·∫ßu nh·∫≠n c√¥ng vi·ªác.
                                </p>
                            </div>
                        ` : ''}
                        <button onclick="window.location.href='login.html'" style="
                            background: linear-gradient(135deg, ${isWorker ? '#3b82f6, #1d4ed8' : '#10b981, #059669'});
                            color: white;
                            border: none;
                            padding: 14px 32px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">${isWorker ? 'ƒê√£ hi·ªÉu' : 'ƒêƒÉng nh·∫≠p ngay'}</button>
                    </div>
                </div>
                <style>
                    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
                </style>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // Auto redirect after 5 seconds for workers, 3 for others
            setTimeout(() => {
                window.location.href = 'login.html';
            }, isWorker ? 5000 : 3000);
        }

        // Form animation on load
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof gsap !== 'undefined') {
                gsap.fromTo('.auth-form',
                    { opacity: 0, y: 30 },
                    { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' }
                );

                gsap.fromTo('.auth-hero__content',
                    { opacity: 0, x: -30 },
                    { opacity: 1, x: 0, duration: 0.6, delay: 0.2, ease: 'power2.out' }
                );
            }
        });

        // Verification function
        async function handleVerification(email) {
            const otpCode = prompt("Vui l√≤ng nh·∫≠p m√£ x√°c th·ª±c (OTP) ƒë√£ g·ª≠i t·ªõi email c·ªßa b·∫°n:");
            if (!otpCode) return;

            try {
                const response = await fetch(`${API_URL}/verify-registration`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, otp: otpCode })
                });
                const data = await response.json();

                if (data.success) {
                    showSuccessModal();
                } else {
                    alert(data.message || 'X√°c th·ª±c th·∫•t b·∫°i');
                }
            } catch (error) {
                console.error('Verify error:', error);
                alert('L·ªói k·∫øt n·ªëi');
            }
        }

        // Form submission handler
        document.getElementById('register-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const phone = document.getElementById('phone')?.value || '';
            const role = document.getElementById('role').value;
            const invitationCode = document.getElementById('invitationCode').value;
            const submitBtn = document.querySelector('.auth-form__submit');

            if (!role) {
                alert('Vui l√≤ng ch·ªçn vai tr√≤ c·ªßa b·∫°n');
                return;
            }

            // Validate password match
            if (password !== confirmPassword) {
                alert('M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√¥ng kh·ªõp!');
                return;
            }

            // Loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="material-symbols-outlined spinning">sync</span> ƒêang x·ª≠ l√Ω...';

            // Build request body
            const requestBody = { fullName, email, password, phone, role };

            // Get farm info or invitation code based on role
            const farmField = document.getElementById('farmName');
            if (role === 'OWNER') {
                requestBody.farmName = farmField.value;
            } else if (role === 'WORKER') {
                requestBody.farmId = parseInt(farmField.value);
                // Get CV fields
                const cvBio = document.getElementById('cv-bio');
                const cvSkill = document.getElementById('cv-skill');
                const cvExperience = document.getElementById('cv-experience');

                let cvProfile = '';
                if (cvBio && cvBio.value) cvProfile += cvBio.value;
                if (cvSkill && cvSkill.value) cvProfile += `\nK·ªπ nƒÉng ch√≠nh: ${cvSkill.options[cvSkill.selectedIndex].text}`;
                if (cvExperience && cvExperience.value) cvProfile += `\nKinh nghi·ªám: ${cvExperience.options[cvExperience.selectedIndex].text}`;

                requestBody.cvProfile = cvProfile;
            } else if (role === 'SYSTEM_ADMIN') {
                requestBody.invitationCode = invitationCode;
            }

            try {
                const response = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.success) {
                    if (data.requiresApproval) {
                        // WORKER registration - show special modal
                        showSuccessModal(data.message, true);
                    } else if (data.requiresVerification) {
                        // SYSTEM_ADMIN registration - needs OTP
                        alert(data.message);
                        handleVerification(email);
                    } else {
                        // OWNER registration - direct success
                        showSuccessModal();
                    }
                } else {
                    alert(data.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'T·∫°o t√†i kho·∫£n';
                }
            } catch (error) {
                console.error('Register error:', error);
                alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng th·ª≠ l·∫°i sau.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'T·∫°o t√†i kho·∫£n';
            }
        });

        // Role change handler - updates farm field dynamically
        document.getElementById('role').addEventListener('change', async function () {
            const role = this.value;
            const farmField = document.getElementById('farm-field');
            const farmLabel = document.getElementById('farm-label');
            const farmWrapper = document.getElementById('farm-input-wrapper');
            const invitationField = document.getElementById('invitation-code-field');
            const roleHint = document.getElementById('role-hint');

            // Reset display
            farmField.style.display = 'block';
            invitationField.style.display = 'none';

            // Update hint
            const hints = {
                'OWNER': 'B·∫°n s·∫Ω c√≥ quy·ªÅn t·∫°o trang tr·∫°i m·ªõi v√† qu·∫£n l√Ω to√†n b·ªô d·ªØ li·ªáu.',
                'WORKER': 'B·∫°n s·∫Ω l√†m vi·ªác t·∫°i m·ªôt n√¥ng tr·∫°i c√≥ s·∫µn trong h·ªá th·ªëng.',
                'SYSTEM_ADMIN': 'Qu·∫£n tr·ªã vi√™n h·ªá th·ªëng - C·∫ßn m√£ m·ªùi ƒë·ªÉ ƒëƒÉng k√Ω.'
            };
            roleHint.textContent = hints[role] || '';

            if (role === 'OWNER') {
                // Show text input for farm name
                farmLabel.textContent = 'T√™n n√¥ng tr·∫°i c·ªßa b·∫°n';
                farmWrapper.innerHTML = `
                    <input type="text" id="farmName" class="auth-form__input" placeholder="Nh·∫≠p t√™n n√¥ng tr·∫°i b·∫°n mu·ªën t·∫°o" required>
                    <span class="material-symbols-outlined auth-form__input-icon">agriculture</span>
                `;
            } else if (role === 'WORKER') {
                // Show CV Form
                farmLabel.textContent = 'Ch·ªçn n√¥ng tr·∫°i ·ª©ng tuy·ªÉn';
                farmWrapper.innerHTML = `
                    <select id="farmName" class="auth-form__input auth-form__select" required>
                        <option value="" disabled selected>ƒêang t·∫£i danh s√°ch...</option>
                    </select>
                    <span class="material-symbols-outlined auth-form__input-icon">agriculture</span>
                `;

                // Add Professional CV Form
                const cvHtml = `
                    <div id="cv-section" class="cv-section" style="margin-top: 24px; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); padding: 24px; border-radius: 16px; border: 2px solid #a7f3d0; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px dashed #6ee7b7;">
                            <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);">
                                <span class="material-symbols-outlined" style="color: white; font-size: 28px;">description</span>
                            </div>
                            <div>
                                <h3 style="font-size: 18px; font-weight: 700; color: #065f46; margin: 0;">H·ªì s∆° ·ª©ng tuy·ªÉn</h3>
                                <p style="font-size: 13px; color: #047857; margin: 4px 0 0 0;">Th√¥ng tin s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ch·ªß trang tr·∫°i</p>
                            </div>
                        </div>
                        
                        <div class="auth-form__field" style="margin-bottom: 16px;">
                            <label class="auth-form__label" style="color: #065f46; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                <span class="material-symbols-outlined" style="font-size: 18px;">person</span>
                                Gi·ªõi thi·ªáu b·∫£n th√¢n & Kinh nghi·ªám
                            </label>
                            <textarea id="cv-bio" class="auth-form__input" rows="4" 
                                placeholder="V√≠ d·ª•: 3 nƒÉm kinh nghi·ªám tr·ªìng l√∫a, bi·∫øt l√°i m√°y c√†y..." 
                                style="padding: 12px; background: white; border: 2px solid #6ee7b7; border-radius: 8px; transition: all 0.2s;"
                                onfocus="this.style.borderColor='#10b981'; this.style.boxShadow='0 0 0 3px rgba(16, 185, 129, 0.2)'"
                                onblur="this.style.borderColor='#6ee7b7'; this.style.boxShadow='none'"></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="auth-form__field">
                                <label class="auth-form__label" style="color: #065f46; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">work</span>
                                    K·ªπ nƒÉng ch√≠nh
                                </label>
                                <select id="cv-skill" class="auth-form__input auth-form__select" style="background: white; border: 2px solid #6ee7b7;">
                                    <option value="">Ch·ªçn k·ªπ nƒÉng...</option>
                                    <option value="farming">üåæ Tr·ªìng tr·ªçt</option>
                                    <option value="livestock">üêÑ ChƒÉn nu√¥i</option>
                                    <option value="machinery">üöú V·∫≠n h√†nh m√°y m√≥c</option>
                                    <option value="irrigation">üíß T∆∞·ªõi ti√™u</option>
                                    <option value="pesticide">üß™ Phun thu·ªëc BVTV</option>
                                    <option value="harvest">üåæ Thu ho·∫°ch</option>
                                    <option value="other">üì¶ Kh√°c</option>
                                </select>
                            </div>
                            <div class="auth-form__field">
                                <label class="auth-form__label" style="color: #065f46; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                    <span class="material-symbols-outlined" style="font-size: 18px;">schedule</span>
                                    NƒÉm kinh nghi·ªám
                                </label>
                                <select id="cv-experience" class="auth-form__input auth-form__select" style="background: white; border: 2px solid #6ee7b7;">
                                    <option value="0">Ch∆∞a c√≥ kinh nghi·ªám</option>
                                    <option value="1">1 - 2 nƒÉm</option>
                                    <option value="3">3 - 5 nƒÉm</option>
                                    <option value="5">5 - 10 nƒÉm</option>
                                    <option value="10">Tr√™n 10 nƒÉm</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 16px; background: white; border-radius: 8px; border: 1px dashed #6ee7b7;">
                            <p style="font-size: 12px; color: #059669; margin: 0; display: flex; align-items: center; gap: 6px;">
                                <span class="material-symbols-outlined" style="font-size: 16px;">info</span>
                                H·ªì s∆° c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ch·ªß trang tr·∫°i ƒë·ªÉ x√©t duy·ªát. Sau khi ƒë∆∞·ª£c duy·ªát, b·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu nh·∫≠n v√† th·ª±c hi·ªán c√¥ng vi·ªác.
                            </p>
                        </div>
                    </div>
                `;
                // Insert CV section after farm field
                if (!document.getElementById('cv-section')) {
                    farmField.insertAdjacentHTML('afterend', cvHtml);
                }

                // Fetch farms from API
                try {
                    const response = await fetch('http://localhost:8080/api/farms/list');
                    let farms = await response.json();

                    // Filter farms with quota > 0 (if backend sends quota, otherwise fetch full details)
                    // The /list endpoint currently returns simplified map. 
                    // We might need to fetch full /api/farms or update /list to include quota.
                    // Assuming /list returns {id, name} only from my previous check.
                    // Let's try to fetch full list or rely on backend.
                    // BETTER: Fetch /api/farms (full) which I added in FarmController as GET /
                    const fullResponse = await fetch('http://localhost:8080/api/farms');
                    if (fullResponse.ok) {
                        farms = await fullResponse.json();
                    }

                    const farmSelect = document.getElementById('farmName');
                    farmSelect.innerHTML = '<option value="" disabled selected>Ch·ªçn n√¥ng tr·∫°i...</option>';

                    // Filter: Quota > 0
                    const hiringFarms = farms.filter(f => (f.recruitmentQuota && f.recruitmentQuota > 0));

                    if (hiringFarms.length === 0) {
                        farmSelect.innerHTML = '<option value="" disabled selected>Kh√¥ng c√≥ n√¥ng tr·∫°i n√†o ƒëang tuy·ªÉn</option>';
                        farmSelect.disabled = true;
                    } else {
                        farmSelect.disabled = false;
                        hiringFarms.forEach(farm => {
                            const option = document.createElement('option');
                            option.value = farm.id;
                            option.textContent = `${farm.name} (Tuy·ªÉn: ${farm.recruitmentQuota})`;
                            farmSelect.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error fetching farms:', error);
                    document.getElementById('farmName').innerHTML = '<option value="" disabled selected>L·ªói t·∫£i danh s√°ch</option>';
                }
            } else if (role === 'SYSTEM_ADMIN') {
                farmField.style.display = 'none';
                invitationField.style.display = 'block';
                // Remove CV if exists
                const cvSection = document.getElementById('cv-section');
                if (cvSection) cvSection.remove();
            } else {
                // Owner or others: Remove CV if exists
                const cvSection = document.getElementById('cv-section');
                if (cvSection) cvSection.remove();
            }
        });

        // Update Submit Handler to include CV
        // (The submit handler reads fields by ID including cv-bio, cv-skill, cv-experience)

        // ============================================
        // GOOGLE REGISTER (Server-side redirect flow)
        // ============================================
        document.getElementById('btn-google-register').addEventListener('click', function() {
            const redirectUri = window.location.origin + '/pages/login.html';
            const googleAuthUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${GOOGLE_CLIENT_ID}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=openid%20email%20profile&state=google_register&access_type=offline&prompt=consent`;
            window.location.href = googleAuthUrl;
        });

        // Handle Google register callback (forwarded from login.html)
        (function handleGoogleRegisterCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');

            if (code && state === 'google_register') {
                window.history.replaceState({}, document.title, window.location.pathname);
                pendingSocialData = {
                    provider: 'google',
                    code: code
                };
                showSocialRoleDialog('Google User', '');
            }
        })();

        // ============================================
        // FACEBOOK REGISTER (Server-side redirect flow)
        // ============================================
        document.getElementById('btn-facebook-register').addEventListener('click', function() {
            const redirectUri = window.location.origin + '/pages/login.html';
            const facebookAuthUrl = `https://www.facebook.com/v18.0/dialog/oauth?client_id=${FACEBOOK_APP_ID}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=public_profile,email&state=facebook_register`;
            window.location.href = facebookAuthUrl;
        });

        // Handle Facebook register callback (forwarded from login.html)
        (function handleFacebookRegisterCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');

            if (code && state === 'facebook_register') {
                window.history.replaceState({}, document.title, window.location.pathname);
                pendingSocialData = {
                    provider: 'facebook',
                    code: code
                };
                showSocialRoleDialog('Facebook User', '');
            }
        })();

        // ============================================
        // GITHUB REGISTER
        // ============================================
        document.getElementById('btn-github-register').addEventListener('click', function() {
            // Use login.html as redirect_uri (must match GitHub OAuth App callback URL)
            // login.html will forward the code to register.html via state=register
            const redirectUri = window.location.origin + '/pages/login.html';
            const githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CLIENT_ID}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=read:user%20user:email&state=register`;
            window.location.href = githubAuthUrl;
        });

        // Handle GitHub OAuth callback for registration
        (function handleGitHubRegisterCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');

            if (code && state === 'register') {
                window.history.replaceState({}, document.title, window.location.pathname);
                pendingSocialData = {
                    provider: 'github',
                    code: code
                };
                showSocialRoleDialog('GitHub User', '');
            }
        })();

        // ============================================
        // SOCIAL ROLE SELECTION DIALOG
        // ============================================
        function showSocialRoleDialog(name, email) {
            document.querySelectorAll('.modal-overlay').forEach(el => el.remove());

            const html = `
                <div id="social-role-modal" class="modal-overlay">
                    <div class="modal-content" style="max-width: 500px; border-top: 4px solid #10b981;">
                        <div class="modal-header">
                            <h3 style="display: flex; align-items: center; gap: 8px;">
                                <span class="material-symbols-outlined" style="color: #10b981;">person_add</span>
                                Ho√†n t·∫•t ƒëƒÉng k√Ω
                            </h3>
                            <p>Xin ch√†o <strong>${name}</strong>${email ? ` (${email})` : ''}! Vui l√≤ng ch·ªçn vai tr√≤ v√† th√¥ng tin b·ªï sung.</p>
                        </div>
                        <div class="modal-body">
                            <!-- Role Selection -->
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <label style="font-size: 14px; font-weight: 600; color: #374151;">Vai tr√≤</label>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="selectSocialRole('OWNER')" id="social-role-owner" 
                                        class="btn btn--secondary" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px; padding: 12px;">
                                        <span class="material-symbols-outlined" style="font-size:18px;">agriculture</span> Ch·ªß trang tr·∫°i
                                    </button>
                                    <button onclick="selectSocialRole('WORKER')" id="social-role-worker"
                                        class="btn btn--secondary" style="flex:1; display:flex; align-items:center; justify-content:center; gap:6px; padding: 12px;">
                                        <span class="material-symbols-outlined" style="font-size:18px;">engineering</span> Nh√¢n c√¥ng
                                    </button>
                                </div>
                            </div>

                            <!-- Dynamic farm fields -->
                            <div id="social-farm-fields" style="display:none; margin-top: 12px;">
                                <div id="social-farm-owner" style="display:none;">
                                    <label style="font-size: 14px; font-weight: 600; color: #374151;">T√™n n√¥ng tr·∫°i</label>
                                    <input type="text" id="social-farm-name" class="modal-input" placeholder="Nh·∫≠p t√™n n√¥ng tr·∫°i" style="margin-top:4px;">
                                </div>
                                <div id="social-farm-worker" style="display:none;">
                                    <label style="font-size: 14px; font-weight: 600; color: #374151;">Ch·ªçn n√¥ng tr·∫°i</label>
                                    <select id="social-farm-select" class="modal-input" style="margin-top:4px;">
                                        <option value="" disabled selected>ƒêang t·∫£i...</option>
                                    </select>
                                    <textarea id="social-cv" class="modal-input" rows="3" placeholder="Gi·ªõi thi·ªáu b·∫£n th√¢n & kinh nghi·ªám..." style="margin-top:8px;"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button onclick="document.getElementById('social-role-modal').remove(); pendingSocialData=null;" class="btn btn--secondary">H·ªßy</button>
                            <button onclick="submitSocialRegister()" id="btn-social-submit" class="btn btn--primary" disabled>ƒêƒÉng k√Ω</button>
                        </div>
                    </div>
                </div>`;
            document.body.insertAdjacentHTML('beforeend', html);

            if (typeof gsap !== 'undefined') {
                gsap.fromTo('#social-role-modal .modal-content', { scale: 0.9, opacity: 0 }, { scale: 1, opacity: 1, duration: 0.3, ease: 'back.out(1.5)' });
            }
        }

        let selectedSocialRole = null;

        async function selectSocialRole(role) {
            selectedSocialRole = role;
            const ownerBtn = document.getElementById('social-role-owner');
            const workerBtn = document.getElementById('social-role-worker');
            const farmFields = document.getElementById('social-farm-fields');
            const farmOwner = document.getElementById('social-farm-owner');
            const farmWorker = document.getElementById('social-farm-worker');
            const submitBtn = document.getElementById('btn-social-submit');

            // Reset styles
            ownerBtn.style.background = '';
            ownerBtn.style.color = '';
            workerBtn.style.background = '';
            workerBtn.style.color = '';

            if (role === 'OWNER') {
                ownerBtn.style.background = '#10b981';
                ownerBtn.style.color = 'white';
                farmFields.style.display = 'block';
                farmOwner.style.display = 'block';
                farmWorker.style.display = 'none';
            } else {
                workerBtn.style.background = '#3b82f6';
                workerBtn.style.color = 'white';
                farmFields.style.display = 'block';
                farmOwner.style.display = 'none';
                farmWorker.style.display = 'block';

                // Load farms list
                try {
                    const response = await fetch('http://localhost:8080/api/farms');
                    const farms = await response.json();
                    const farmSelect = document.getElementById('social-farm-select');
                    farmSelect.innerHTML = '<option value="" disabled selected>Ch·ªçn n√¥ng tr·∫°i...</option>';

                    const hiringFarms = farms.filter(f => f.recruitmentQuota && f.recruitmentQuota > 0);
                    if (hiringFarms.length === 0) {
                        farmSelect.innerHTML = '<option value="" disabled selected>Kh√¥ng c√≥ n√¥ng tr·∫°i n√†o ƒëang tuy·ªÉn</option>';
                    } else {
                        hiringFarms.forEach(farm => {
                            const option = document.createElement('option');
                            option.value = farm.id;
                            option.textContent = `${farm.name} (Tuy·ªÉn: ${farm.recruitmentQuota})`;
                            farmSelect.appendChild(option);
                        });
                    }
                } catch (e) {
                    console.error('Error loading farms:', e);
                }
            }

            submitBtn.disabled = false;
        }

        async function submitSocialRegister() {
            if (!pendingSocialData || !selectedSocialRole) return;

            const submitBtn = document.getElementById('btn-social-submit');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="material-symbols-outlined spinning">sync</span> ƒêang x·ª≠ l√Ω...';

            const body = {
                role: selectedSocialRole
            };

            if (selectedSocialRole === 'OWNER') {
                body.farmName = document.getElementById('social-farm-name')?.value || '';
                if (!body.farmName) {
                    alert('Vui l√≤ng nh·∫≠p t√™n n√¥ng tr·∫°i');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ƒêƒÉng k√Ω';
                    return;
                }
            } else if (selectedSocialRole === 'WORKER') {
                body.farmId = document.getElementById('social-farm-select')?.value;
                body.cvProfile = document.getElementById('social-cv')?.value || '';
                if (!body.farmId) {
                    alert('Vui l√≤ng ch·ªçn n√¥ng tr·∫°i');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ƒêƒÉng k√Ω';
                    return;
                }
            }

            let endpoint = '';
            const redirectUri = window.location.origin + '/pages/login.html';
            if (pendingSocialData.provider === 'google') {
                endpoint = `${API_URL}/google/register`;
                body.code = pendingSocialData.code;
                body.redirectUri = redirectUri;
            } else if (pendingSocialData.provider === 'facebook') {
                endpoint = `${API_URL}/facebook/register`;
                body.code = pendingSocialData.code;
                body.redirectUri = redirectUri;
            } else if (pendingSocialData.provider === 'github') {
                endpoint = `${API_URL}/github/register`;
                body.code = pendingSocialData.code;
            }

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await response.json();

                document.getElementById('social-role-modal')?.remove();
                pendingSocialData = null;

                if (data.success || data.requiresApproval) {
                    if (data.requiresApproval) {
                        showSuccessModal(data.message, true);
                    } else {
                        showSuccessModal('ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay.', false);
                    }
                } else {
                    alert(data.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
                }
            } catch (error) {
                console.error('Social register error:', error);
                alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ƒêƒÉng k√Ω';
            }
        }

    </script>

    <!-- Testimonials Carousel -->
    <script>
    (function() {
        const container = document.getElementById('register-testimonials');
        const dotsContainer = document.getElementById('register-carousel-dots');
        if (!container || !dotsContainer) return;

        const slides = container.querySelectorAll('.auth-testimonial-slide');
        const dots = dotsContainer.querySelectorAll('.auth-carousel-dot');
        let currentIndex = 0;
        let interval;

        function goToSlide(index) {
            slides[currentIndex].classList.remove('active');
            dots[currentIndex].classList.remove('active');
            currentIndex = index;
            slides[currentIndex].classList.add('active');
            dots[currentIndex].classList.add('active');
        }

        function nextSlide() {
            goToSlide((currentIndex + 1) % slides.length);
        }

        function startAutoRotate() {
            interval = setInterval(nextSlide, 10000);
        }

        dots.forEach(dot => {
            dot.addEventListener('click', function() {
                clearInterval(interval);
                goToSlide(parseInt(this.dataset.index));
                startAutoRotate();
            });
        });

        startAutoRotate();
    })();
    </script>
</body>

</html>